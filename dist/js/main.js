var ioann=angular.module("ioann",["ngRoute","angular-toArrayFilter","ngAnimate"]);ioann.config(["$routeProvider",function(e){e.when("/",{templateUrl:"partials/land.html",controller:"landCtrl"}).when("/family",{templateUrl:"partials/family.html",controller:"familyCtrl"}).when("/celebrations",{templateUrl:"partials/celebrations.html",controller:"celebrationsCtrl"}).otherwise({redirectTo:"/"})}]),ioann.controller("landCtrl",["$scope","$timeout",function(e,o){e.videoplayng=!1;var s=null;videojs.getPlayers().div_video&&videojs("div_video").dispose(),videojs("div_video",{bigPlayButton:!1}).ready(function(){e.video=this,e.hideVideo=function(){e.videoplayng=!1,e.video.posterImage.show(),e.video.userActive(!1),s=null},e.showVideo=function(){e.videoplayng=!0,e.video.userActive(!0)},e.video.on("ended",function(){o(e.hideVideo),e.video.currentTime(0)}),e.video.on("play",function(){null!=s?o.cancel(s):o(e.showVideo)}),e.closeVideo=function(){e.video.pause(),e.hideVideo()},e.playVideo=function(){e.video.play()}})}]),ioann.controller("familyCtrl",["$scope","$http",function(e,o){e.showpers=!1,e.personalys=[],e.points=[],e.showpeople=function(){0===e.personalys.length?o.get("/data/personalys.json").then(function(o){e.personalys=o.data,e.showpers=!e.showpers}):e.showpers=!e.showpers},e.selectPersonaly=function(o){angular.forEach(e.personalys,function(e){e.visible=!1}),o.visible=!0},e.getPoints=function(){o.get("/data/pointsmap.json").then(function(o){e.points=o.data,e.showpoints=!e.showpoints})},e.getPoints()}]),ioann.controller("celebrationsCtrl",["$scope","$http","$compile","$timeout",function(e,o,s,p){e.showpers=!1,e.showchrons=!1,e.showpoints=!1,e.mousedown=!1,e.showvideo=!1,e.personalys=[],e.chronics=[],videojs.getPlayers().div_video&&videojs("div_video").dispose(),videojs("div_video",{bigPlayButton:!1}).ready(function(){e.video=this}),e.map=L.map("mapid",{zoomControl:!1,attributionControl:!1,dragging:!1}).setView([61.66235,40.2058416666667],6),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"lenseg.00o6mm4a",accessToken:"pk.eyJ1IjoibGVuc2VnIiwiYSI6ImNpbm8yeTlqazB6bm91Nmx5OHhycnNwN3AifQ.2_7w87K3h6dfp_ohKsS1Gg"}).addTo(e.map);var t=function(o,p){var t,i="map-celebration-point",a="popup",r=L.point(125,-50);o.properties.bigicon&&(i+="-big"),o.properties.alwaysvisible&&(i+=" map-celebration-point-alwaysvisible"),o.properties.leftsided&&(r=L.point(-272,80),a=a+" "+a+"-leftsided");var n="<div class='"+a+"'><a href='' class='popup_media' ng-click='showSlides("+JSON.stringify(o.properties.slides)+")'>Фото <div class='popupposter' style='background-image:url("+o.properties.photobg+")'></div></a><a href='' class='popup_media' ng-click='playVideo("+JSON.stringify(o.properties.video)+")'>Видео<div class='popupposter' style='background-image:url("+o.properties.videobg+")'></div></a><p class='popup_discription'>"+o.properties.Description+"</p></div>",c=s(n),d=c(e),g=L.popup({closeButton:!1,autoPan:!1}).setContent(d[0]);return t=L.marker(p,{icon:L.divIcon({className:i,popupAnchor:r,html:'<span class="marker-title">'+o.properties.Name+"</span>"})}),t.bindPopup(g),t};geoJsonObj=[{type:"Feature",properties:{photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],Name:"Кронштадт",Description:"gjgjhg"},geometry:{type:"Point",coordinates:[29.7774972222222,59.9927666666667,0]}},{type:"Feature",properties:{photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],bigicon:!0,alwaysvisible:!0,Name:"Санкт-Петербург",Description:"gjgjhg"},geometry:{type:"Point",coordinates:[30.3353111111111,59.9313638888889,0]}},{type:"Feature",properties:{leftsided:!0,photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],Name:"Коноша",Description:"gjgjhg"},geometry:{type:"Point",coordinates:[40.2539055555556,60.9735333333333,0]}},{type:"Feature",properties:{leftsided:!0,photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],Name:"Няндома",Description:"gjgjhg"},geometry:{type:"Point",coordinates:[40.2058416666667,61.66235,0]}},{type:"Feature",properties:{leftsided:!0,photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],Name:"Плесецк",Description:"gjgjhg"},geometry:{type:"Point",coordinates:[40.2957916666667,62.7079472222222,0]}},{type:"Feature",properties:{leftsided:!0,photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],bigicon:!0,Name:"Обозерская",Description:"gjgjhg"},geometry:{type:"Point",coordinates:[40.3113916666667,63.4488888888889,0]}},{type:"Feature",properties:{leftsided:!0,photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],Name:"Архангельск",Description:"gjgjhg"},geometry:{type:"Point",coordinates:[40.5747222222222,64.5508333333333,0]}},{type:"Feature",properties:{photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],Name:"Карпогоры",Description:"gjgjhg"},geometry:{type:"Point",coordinates:[44.4041638888889,64.0416694444444,0]}},{type:"Feature",properties:{photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],Name:"Сура",alwaysvisible:!0,Description:"gjgjhg"},geometry:{type:"Point",coordinates:[45.6324,63.5755361111111,0]}}];var i=L.geoJson(geoJsonObj,{pointToLayer:t}).addTo(e.map),a=L.polyline([],{color:"#f7f7f7",weight:2,opacity:1}).addTo(e.map);i.eachLayer(function(e){a.addLatLng(e.getLatLng())});var r=null;e.map.on("popupclose",function(){r=p(function(){e.map.setView([61.66235,40.2058416666667],6,{animate:!0,pan:{easeLinearity:1}})},100)}),e.map.on("popupopen",function(o){p.cancel(r),e.map.setView(o.popup._latlng,9,{animate:!0,pan:{easeLinearity:1}})});var n=angular.element(document.getElementById("mapid")),c=n[0].offsetHeight/2,d=n[0].offsetWidth/2,g=angular.element(document.getElementsByClassName("leaflet-tile-pane")),v=angular.element(document.getElementsByClassName("leaflet-objects-pane"));e.map.on("mousemove",function(e){var o=e.originalEvent.layerX,s=e.originalEvent.layerY,p=d-o,t=c-s,i=p/d*(2*d)/50,a=t/c*(2*c)/50;g[0].style.transform="translate3d("+i+"px,"+a+"px,0)",v[0].style.transform="translate3d("+i/1.5+"px,"+a/1.5+"px,0)"}),e.slidesVisibility=!1,e.showSlides=function(o){e.slides=o,e.slides[0].visible=!0,e.slidesVisibility=!0},e.closeSlides=function(){e.slidesVisibility=!1,e.slides=[]},e.moveToSlide=function(o){var s=0,p=parseInt(o);angular.forEach(e.slides,function(e,o,t){e.visible&&(s=o==t.length-1&&p>0?-1:0==o&&0>p?t.length:o),e.visible=!1}),e.slides[s+p].visible=!0},e.playVideo=function(o){e.video.src(o),e.showvideo=!0,e.video.play()},e.closeVideo=function(){e.showvideo=!1,e.video.pause()},e.showhroniks=function(){0===e.chronics.length?o.get("/data/chronics.json").then(function(o){e.chronics=o.data,e.chronics[Object.keys(e.chronics)[0]].visible=!0,e.chronicsscren=e.chronics[Object.keys(e.chronics)[0]].screenshot,e.showchrons=!e.showchrons}):e.showchrons=!e.showchrons},e.selectChronic=function(o){angular.forEach(e.chronics,function(e){e.visible=!1}),o.visible=!0},e.chronickMousover=function(o){e.mousedown&&e.selectChronic(o)},e.chronickMousedown=function(){e.mousedown=!0},document.documentElement.addEventListener("mouseup",function(o){e.mousedown=!1})}]),ioann.directive("imageonload",function(){return{restrict:"A",link:function(e,o){o.on("load",function(){o.removeClass("spinner-hide"),o.addClass("spinner-show"),o.parent().find("span").remove()}),e.$watch("ngSrc",function(){o.addClass("spinner-hide"),o.parent().append('<span class="spinner"></span>')})}}});