var ioann=angular.module("ioann",["ngRoute","angular-toArrayFilter","ngAnimate"]);ioann.config(["$routeProvider",function(e){e.when("/",{templateUrl:"partials/land.html",controller:"landCtrl"}).when("/family",{templateUrl:"partials/family.html",controller:"familyCtrl"}).when("/celebrations",{templateUrl:"partials/celebrations.html",controller:"celebrationsCtrl"}).otherwise({redirectTo:"/"})}]),ioann.controller("landCtrl",["$scope","$timeout",function(e,o){e.videoplayng=!1;var s=null;videojs.getPlayers().div_video&&videojs("div_video").dispose(),videojs("div_video",{bigPlayButton:!1}).ready(function(){e.video=this,e.hideVideo=function(){e.videoplayng=!1,e.video.posterImage.show(),e.video.userActive(!1),s=null},e.showVideo=function(){e.videoplayng=!0,e.video.userActive(!0)},e.video.on("ended",function(){o(e.hideVideo),e.video.currentTime(0)}),e.video.on("play",function(){null!=s?o.cancel(s):o(e.showVideo)}),e.closeVideo=function(){e.video.pause(),e.hideVideo()},e.playVideo=function(){e.video.play()}})}]),ioann.controller("familyCtrl",["$scope","$http",function(e,o){e.showpers=!1,e.personalys=[],e.points=[],e.showpeople=function(){0===e.personalys.length?o.get("/data/personalys.json").then(function(o){e.personalys=o.data,e.showpers=!e.showpers}):e.showpers=!e.showpers},e.selectPersonaly=function(o){angular.forEach(e.personalys,function(e){e.visible=!1}),o.visible=!0},e.getPoints=function(){o.get("/data/pointsmap.json").then(function(o){e.points=o.data,e.showpoints=!e.showpoints})},e.getPoints()}]),ioann.controller("celebrationsCtrl",["$scope","$http","$compile","$timeout",function(e,o,s,t){function i(e){var o=e.originalEvent.layerX,s=e.originalEvent.layerY,t=l-o,i=c-s,a=t/l*(2*l)/50,p=i/c*(2*c)/50;window.requestAnimationFrame(function(){m[0].style.transform="translate3d("+a+"px,"+p+"px,0)",g[0].style.transform="translate3d("+a/1.5+"px,"+p/1.5+"px,0)",h[0].style.transform="translate3d("+a/1.1+"px,"+p/1.1+"px,0)"})}e.showpers=!1,e.showchrons=!1,e.showpoints=!1,e.mousedown=!1,e.showvideo=!1,e.personalys=[],e.chronics=[],videojs.getPlayers().div_video&&videojs("div_video").dispose(),videojs("div_video",{bigPlayButton:!1}).ready(function(){e.video=this}),e.map=L.map("mapid",{zoomControl:!1,attributionControl:!1,dragging:!1}).setView([61.66235,40.2058416666667],6),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"lenseg.00o6mm4a",accessToken:"pk.eyJ1IjoibGVuc2VnIiwiYSI6ImNpbm8yeTlqazB6bm91Nmx5OHhycnNwN3AifQ.2_7w87K3h6dfp_ohKsS1Gg"}).addTo(e.map);var a=function(o,t){var i,a="map-celebration-point",p="popup",n=L.point(125,-50);o.properties.bigicon&&(a+="-big"),o.properties.alwaysvisible&&(a+=" map-celebration-point-alwaysvisible"),o.properties.leftsided&&(n=L.point(-272,80),p=p+" "+p+"-leftsided");var r="<div class='"+p+"'><a href='' class='popup_media' ng-click='showSlides("+JSON.stringify(o.properties.slides)+")'>Фото <div class='popupposter' style='background-image:url("+o.properties.photobg+")'></div></a><a href='' class='popup_media' ng-click='playVideo("+JSON.stringify(o.properties.video)+")'>Видео<div class='popupposter' style='background-image:url("+o.properties.videobg+")'></div></a><p class='popup_discription'>"+o.properties.Description+"</p></div>",d=s(r),c=d(e),l=L.popup({closeButton:!1,autoPan:!1}).setContent(c[0]);return i=L.marker(t,{icon:L.divIcon({className:a,popupAnchor:n,html:'<span class="marker-title">'+o.properties.Name+"</span>"})}),i.bindPopup(l),i};geoJsonObj=[{type:"Feature",properties:{photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],Name:"Кронштадт",Description:"gjgjhg"},geometry:{type:"Point",coordinates:[29.7774972222222,59.9927666666667,0]}},{type:"Feature",properties:{photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],bigicon:!0,alwaysvisible:!0,Name:"Санкт-Петербург",Description:"gjgjhg"},geometry:{type:"Point",coordinates:[30.3353111111111,59.9313638888889,0]}},{type:"Feature",properties:{leftsided:!0,photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],Name:"Коноша",Description:"gjgjhg"},geometry:{type:"Point",coordinates:[40.2539055555556,60.9735333333333,0]}},{type:"Feature",properties:{leftsided:!0,photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],Name:"Няндома",Description:"gjgjhg"},geometry:{type:"Point",coordinates:[40.2058416666667,61.66235,0]}},{type:"Feature",properties:{leftsided:!0,photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],Name:"Плесецк",Description:"gjgjhg"},geometry:{type:"Point",coordinates:[40.2957916666667,62.7079472222222,0]}},{type:"Feature",properties:{leftsided:!0,photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],bigicon:!0,Name:"Обозерская",Description:"gjgjhg"},geometry:{type:"Point",coordinates:[40.3113916666667,63.4488888888889,0]}},{type:"Feature",properties:{leftsided:!0,photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],Name:"Архангельск",Description:"gjgjhg"},geometry:{type:"Point",coordinates:[40.5747222222222,64.5508333333333,0]}},{type:"Feature",properties:{photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],Name:"Карпогоры",Description:"gjgjhg"},geometry:{type:"Point",coordinates:[44.4041638888889,64.0416694444444,0]}},{type:"Feature",properties:{photobg:"/img/popupposters/1/photo.jpg",videobg:"/img/popupposters/1/video.jpg",slides:[{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c629630/v629630927/1c2e/Ci9yMB-KWR8.jpg",discr:"sadadas"}},{photo:{src:"https://pp.vk.me/c631616/v631616927/28a4e/DPVvqyZ5JVc.jpg",discr:"sadadas"}}],video:[{type:"video/mp4",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"},{type:"video/ogg",src:"http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv"}],Name:"Сура",alwaysvisible:!0,Description:"gjgjhg"},geometry:{type:"Point",coordinates:[45.6324,63.5755361111111,0]}}];var p=L.geoJson(geoJsonObj,{pointToLayer:a}).addTo(e.map),n=L.polyline([],{color:"#f7f7f7",weight:2,opacity:1}).addTo(e.map);p.eachLayer(function(e){n.addLatLng(e.getLatLng())});var r=null;e.map.on("popupclose",function(){r=t(function(){e.map.setView([61.66235,40.2058416666667],6,{animate:!0,pan:{easeLinearity:1}})},100)}),e.map.on("popupopen",function(o){t.cancel(r),e.map.setView(o.popup._latlng,9,{animate:!0,pan:{easeLinearity:1}})});var d=angular.element(document.getElementById("mapid")),c=d[0].offsetHeight/2,l=d[0].offsetWidth/2,m=angular.element(document.getElementsByClassName("leaflet-tile-pane")),g=angular.element(document.getElementsByClassName("leaflet-objects-pane")),h=angular.element(document.getElementsByClassName("cloudscontainer"));e.map.on("mousemove",i),e.slidesVisibility=!1,e.showSlides=function(o){e.slides=o,e.slides[0].visible=!0,e.slidesVisibility=!0},e.closeSlides=function(){e.slidesVisibility=!1,e.slides=[]},e.moveToSlide=function(o){var s=0,t=parseInt(o);angular.forEach(e.slides,function(e,o,i){e.visible&&(s=o==i.length-1&&t>0?-1:0==o&&0>t?i.length:o),e.visible=!1}),e.slides[s+t].visible=!0},e.playVideo=function(o){e.video.src(o),e.showvideo=!0,e.video.play()},e.closeVideo=function(){e.showvideo=!1,e.video.pause()},e.showhroniks=function(){0===e.chronics.length?o.get("/data/chronics.json").then(function(o){e.chronics=o.data,e.chronics[Object.keys(e.chronics)[0]].visible=!0,e.chronicsscren=e.chronics[Object.keys(e.chronics)[0]].screenshot,e.showchrons=!e.showchrons}):e.showchrons=!e.showchrons},e.selectChronic=function(o){angular.forEach(e.chronics,function(e){e.visible=!1}),o.visible=!0},e.chronickMousover=function(o){e.mousedown&&e.selectChronic(o)},e.chronickMousedown=function(){e.mousedown=!0},document.documentElement.addEventListener("mouseup",function(o){e.mousedown=!1}),e.map.addLayer(new cloudLayer(L.latLng(61.66235,40.2058416666667))),document.getElementsByClassName("cloudscontainer")[0].style.transform="none";for(var u=0;u<20+Math.round(10*Math.random());u++)generateCloud();e.map.on("zoomend",function(){e.map.getZoom()<7&&(document.getElementsByClassName("cloudscontainer")[0].style.transform="none",document.getElementsByClassName("cloudscontainer")[0].style.visibility="visible"),e.map.getZoom()>7&&(document.getElementsByClassName("cloudscontainer")[0].style.visibility="hidden")})}]),ioann.directive("imageonload",function(){return{restrict:"A",link:function(e,o){o.on("load",function(){o.removeClass("spinner-hide"),o.addClass("spinner-show"),o.parent().find("span").remove()}),e.$watch("ngSrc",function(){o.addClass("spinner-hide"),o.parent().append('<span class="spinner"></span>')})}}});var cloudBases=[],clouds=[];generateCloud=function(){var e=angular.element(document.getElementById("mapid")),o=document.getElementsByClassName("cloudscontainer")[0],s=e[0].offsetHeight,t=e[0].offsetWidth,i={obj:document.createElement("div")};i.obj.className="cloudBase",i.transform={x:Math.round(Math.random()*t),y:Math.round(Math.random()*s)};var a="translateX( "+i.transform.x+"px )     translateY( "+i.transform.y+"px )";i.obj.style.transform=a,i.obj.style.webkiTransform=a;for(var p=0;p<5+Math.round(10*Math.random());p++){var n={obj:document.createElement("div")};n.obj.className="cloud",n.transform={x:Math.round(40*Math.random()),y:Math.round(40*Math.random()),r:Math.round(360*Math.random()),s:1+Math.random()};var a="translateX( "+n.transform.x+"px ) translateY( "+n.transform.y+"px ) rotate( "+n.transform.r+"deg ) scale("+n.transform.s+")";n.obj.style.transform=a,n.obj.style.webkiTransform=a,i.obj.appendChild(n.obj),clouds.push(n)}o.appendChild(i.obj),cloudBases.push(i),requestAnimationFrame(function(){return udpadeClouds(new Date)}),udpadeClouds=function(e){for(var o=(angular.element(document.getElementById("mapid")),new Date),i=(e-o)/5e3,a=cloudBases.length-1;a>=0;a--){cloudBases[a].transform.x=cloudBases[a].transform.x+5*Math.random()*i,cloudBases[a].transform.y=cloudBases[a].transform.y+2*Math.random()*i,cloudBases[a].transform.x<-100&&(cloudBases[a].transform.x=t+100,cloudBases[a].obj.style.transition="none"),cloudBases[a].transform.y<-100&&(cloudBases[a].transform.y=s+100,cloudBases[a].obj.style.transition="none"),cloudBases[a].transform.y<s+30&&cloudBases[a].transform.x<t+30&&(cloudBases[a].obj.style.transition="transform 1000ms linear");var p="translateX( "+cloudBases[a].transform.x+"px )         translateY( "+cloudBases[a].transform.y+"px )";cloudBases[a].obj.style.transform=p}for(var a=clouds.length-1;a>=0;a--){clouds[a].transform.r=clouds[a].transform.r+5*Math.random()*i;var p="translateX( "+clouds[a].transform.x+"px ) translateY( "+clouds[a].transform.y+"px ) rotate( "+clouds[a].transform.r+"deg ) scale("+clouds[a].transform.s+")";clouds[a].obj.style.transform=p}return requestAnimationFrame(function(){return udpadeClouds(o)})}};var cloudLayer=L.Class.extend({initialize:function(e){this._latlng=e},onAdd:function(e){this._map=e,this._el=L.DomUtil.create("div","cloudscontainer leaflet-zoom-hide"),e.getPanes().overlayPane.appendChild(this._el),e.on("viewreset",this._reset,this),this._reset()},onRemove:function(e){e.getPanes().overlayPane.removeChild(this._el),e.off("viewreset",this._reset,this)},_reset:function(){var e=this._map.latLngToLayerPoint(this._latlng);L.DomUtil.setPosition(this._el,e)}});